---
title: "Data Cleaning and Modeling"
author: "Matt Johnson"
date: "10/27/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
```

Import Data

```{r}
Game.Results = read.csv("GameResults.csv")
Game.Stats = read.csv("GameStats.csv")
Predictions = read.csv("Predictions.csv")
```

Cleaning

```{r}
Game.Stats$School <- as.character(Game.Stats$School)
Game.Stats$School[Game.Stats$School == "Miami (FL)"] <- "Miami"

Game.Stats$Opponent <- as.character(Game.Stats$Opponent)
Game.Stats$Opponent[Game.Stats$Opponent == "Miami (FL)"] <- "Miami"

Game.Stats$School <- as.character(Game.Stats$School)
Game.Stats$School[Game.Stats$School == "Miami (OH)"] <- "Miami Ohio"

Game.Stats$Opponent <- as.character(Game.Stats$Opponent)
Game.Stats$Opponent[Game.Stats$Opponent == "Miami (OH)"] <- "Miami Ohio"

Game.Results$Home.Team <- as.character(Game.Results$Home.Team)
Game.Results$Home.Team[Game.Results$Home.Team == "Miami Florida"] <- "Miami"

Game.Results$Visitor.Team <- as.character(Game.Results$Visitor.Team)
Game.Results$Visitor.Team[Game.Results$Visitor.Team == "Miami Florida"] <- "Miami"

Game.Stats$School <- as.character(Game.Stats$School)
Game.Stats$School[Game.Stats$School == "North Carolina State"] <- "NC State"

Game.Stats$Opponent <- as.character(Game.Stats$Opponent)
Game.Stats$Opponent[Game.Stats$Opponent == "North Carolina State"] <- "NC State"

Game.Stats$School <- as.character(Game.Stats$School)
Game.Stats$School[Game.Stats$School == "Florida International"] <- "FIU"

Game.Stats$Opponent <- as.character(Game.Stats$Opponent)
Game.Stats$Opponent[Game.Stats$Opponent == "Florida International"] <- "FIU"

Game.Results$Home.Team <- as.character(Game.Results$Home.Team)
Game.Results$Home.Team[Game.Results$Home.Team == "Florida Intl"] <- "FIU"

Game.Results$Visitor.Team <- as.character(Game.Results$Visitor.Team)
Game.Results$Visitor.Team[Game.Results$Visitor.Team == "Florida Intl"] <- "FIU"

Game.Stats$School <- as.character(Game.Stats$School)
Game.Stats$School[Game.Stats$School == "Pittsburgh"] <- "Pitt"

Game.Stats$Opponent <- as.character(Game.Stats$Opponent)
Game.Stats$Opponent[Game.Stats$Opponent == "Pittsburgh"] <- "Pitt"

Game.Results$Home.Team <- as.character(Game.Results$Home.Team)
Game.Results$Home.Team[Game.Results$Home.Team == "Pittsburgh"] <- "Pitt"

Game.Results$Visitor.Team <- as.character(Game.Results$Visitor.Team)
Game.Results$Visitor.Team[Game.Results$Visitor.Team == "Pittsburgh"] <- "Pitt"

Game.Stats.Away <- Game.Stats %>% 
  filter(X == "@")
Game.Stats.Home <- Game.Stats %>% 
  filter(X == "")
#not sure what to do with this yet but we can figure it out
Game.Stats.N <- Game.Stats %>% 
  filter(X == "N")

Game.Stats.Home.1 <-  Game.Stats.Home %>% 
  rename(Home.Team = School) %>% 
  rename(Visitor.Team = Opponent) %>% 
  select(c(-1, -4, -5))

Game.Stats.Away.1 <-  Game.Stats.Away %>% 
  rename(Visitor.Team = School) %>% 
  rename(Home.Team = Opponent) %>% 
  select(c(-1, -4, -5))
varname.away = 'Away'
names(Game.Stats.Away.1)[4:ncol(Game.Stats.Away.1)] <- paste0(rep(varname.away), "_", c(names(Game.Stats.Away.1[, 4:23])))

varname.home <-  'Home'
Game.Stats.V2 <- na.omit(full_join(Game.Stats.Home.1, Game.Stats.Away.1))
names(Game.Stats.V2)[4:23] <- paste0(rep(varname.home), "_", c(names(Game.Stats.Home.1[, 4:23])))

#Game.Results cleaning
Game.Results.V2 <- Game.Results %>% 
  select(c(1:5, 8, 9, 10))

Game.Data.V1 <- na.omit(left_join(Game.Stats.V2, Game.Results.V2))
```

```{r}
O.Stats17 = read_xlsx("2017OStats.xlsx", skip = 1)
D.Stats17 = read_xlsx("2017DStats.xlsx", skip = 1)

O.Rank17 = data.frame(O.Stats17$School, O.Stats17$O.Rank17)
colnames(O.Rank17)[colnames(O.Rank17)=="O.Stats17.School"] <- "Home.Team"
colnames(O.Rank17)[colnames(O.Rank17)=="O.Stats17.O.Rank17"] <- "Home.O.Rank"

D.Rank17 = data.frame(D.Stats17$School, D.Stats17$D.Rank17)
colnames(D.Rank17)[colnames(D.Rank17)=="D.Stats17.School"] <- "Home.Team"
colnames(D.Rank17)[colnames(D.Rank17)=="D.Stats17.D.Rank17"] <- "Home.D.Rank"

Data17 = filter(Game.Data.V1, str_detect(Date, '2017'))

join = left_join(Data17, O.Rank17)
join2 = left_join(join, D.Rank17)

colnames(O.Rank17)[colnames(O.Rank17)=="Home.Team"] <- "Visitor.Team"
colnames(O.Rank17)[colnames(O.Rank17)=="Home.O.Rank"] <- "Visitor.O.Rank"

colnames(D.Rank17)[colnames(D.Rank17)=="Home.Team"] <- "Visitor.Team"
colnames(D.Rank17)[colnames(D.Rank17)=="Home.D.Rank"] <- "Visitor.D.Rank"

join3 = left_join(join2, O.Rank17)
join4 = left_join(join3, D.Rank17)
```

```{r}
O.Stats18 = read_xlsx("2018OStats.xlsx", skip = 1)
D.Stats18 = read_xlsx("2018DStats.xlsx", skip = 1)

O.Rank18 = data.frame(O.Stats18$School, O.Stats18$O.Rank18)
colnames(O.Rank18)[colnames(O.Rank18)=="O.Stats18.School"] <- "Home.Team"
colnames(O.Rank18)[colnames(O.Rank18)=="O.Stats18.O.Rank18"] <- "Home.O.Rank"

D.Rank18 = data.frame(D.Stats18$School, D.Stats18$D.Rank18)
colnames(D.Rank18)[colnames(D.Rank18)=="D.Stats18.School"] <- "Home.Team"
colnames(D.Rank18)[colnames(D.Rank18)=="D.Stats18.D.Rank18"] <- "Home.D.Rank"

Data18 = filter(Game.Data.V1, str_detect(Date, '2018'))

join5 = left_join(Data18, O.Rank18)
join6 = left_join(join5, D.Rank18)

colnames(O.Rank18)[colnames(O.Rank18)=="Home.Team"] <- "Visitor.Team"
colnames(O.Rank18)[colnames(O.Rank18)=="Home.O.Rank"] <- "Visitor.O.Rank"

colnames(D.Rank18)[colnames(D.Rank18)=="Home.Team"] <- "Visitor.Team"
colnames(D.Rank18)[colnames(D.Rank18)=="Home.D.Rank"] <- "Visitor.D.Rank"

join7 = left_join(join6, O.Rank18)
join8 = left_join(join7, D.Rank18)

Game.Data.V2 = rbind(join4, join8)
#only team missing is Mercer for the predictions, still need to change Pitt in predictions data
write.csv(Game.Data.V2, file = "Final_Game_Data.csv")
```


Setting up data for predictions
```{r}
Data19 <-  filter(Game.Data.V1, str_detect(Date, '2019'))

Pred.data <- Data19[, -c(2, 23, 44:48)]
#no mercer, only one clemson game, may have to look into using games from 2018 and avg those in too. 
```
